# 事务相关

## 1. 什么是事务

事务具有一致性，原子性，隔离性，永久性
	原子性：一个事务是不可分割的工作单位，要么不做，要么都做
	一致性：事务必须是使数据库从一个状态到另一个状态，跟原子性密切相关
	隔离性：一个事务的执行不能被其他事务所干扰，一个事务所使用的数据以及其内部操作对并发的其他事务时隔离的，并发执行的各个事务之间不能被干扰
	永久性：一个事务一旦提交，它对数据库的操作就应该是永久的，接下来的其他操作或者数据库故障不能对其进行影响

## 2. 事务隔离级别是什么？有哪些隔离级别？每种隔离级别会出现什么现象

| 事务隔离级别                 | 脏读 | 不可重复读 | 幻读 |
| ---------------------------- | ---- | ---------- | ---- |
| 读未提交（read-uncommitted） | 是   | 是         | 是   |
| 不可重复读（read-committed） | 否   | 是         | 是   |
| 可重复读（repeatable-read）  | 否   | 否         | 是   |
| 串行化（serializable）       | 否   | 否         | 否   |

##### 隔离性

1. 修改隔离级别

   set session transaction isolation level read uncommitted

2. 查看隔离级别

   select @@tx_isolation

##### 脏读，不可重复读，幻读 区别

​		1、脏读：事务A读取了事务B更新的数据，然后B回滚操作，那么A读取到的数据是脏数据

　　2、不可重复读：事务 A 多次读取同一数据，事务 B 在事务A多次读取的过程中，对数据作了更新并提交，导致事务A多次读取同一数据时，结果 不一致。

　　3、幻读：系统管理员A将数据库中所有学生的成绩从具体分数改为ABCDE等级，但是系统管理员B就在这个时候插入了一条具体分数的记录，当系统管理员A改结束后发现还有一条记录没有改过来，就好像发生了幻觉一样，这就叫幻读。（A事务查询全部数据，14条，此时 B事务插入了一条，然后提交了，这是A事务再次查询发现有了 15条，这就是幻读）

　　小结：不可重复读的和幻读很容易混淆，不可重复读侧重于修改，幻读侧重于新增或删除。**解决不可重复读的问题只需锁住满足条件的行**，***解决幻读需要锁表***

spring 事务传播机制：



| 名称          | 含义                                                         |
| ------------- | ------------------------------------------------------------ |
| REQUIRED      | 支持当前事务，如果不存在则创建一个新事务。类似于同名的EJB事务属性。这是事务注释的默认设置。 |
| SUPPORTS      | 支持当前事务，如果不存在则非事务执行。                       |
| MANDATORY     | 支持当前事务，如果不存在则抛出异常。                         |
| REQUIRES_NEW  | 创建一个新的事务，并暂停当前事务（如果存在）。实际的事务暂停不会在所有事务管理器中即开即用。 |
| NOT_SUPPORTED | 非事务执行，如果存在当前事务，则挂起当前事务。实际的事务暂停不会在所有事务管理器中即开即用。 |
| NEVER         | 非事务执行，如果存在事务，则引发异常。                       |
| NESTED        | 如果当前事务存在，则在嵌套事务中执行，                       |



## 3. 锁是什么，mysql 中有哪些锁

锁，就是锁住，比如说行锁，操作的时候，锁住这一行，别的操作都等待

表锁，锁住表，别的操作都等待！



